#í•„ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ ì–¸
import csv
import matplotlib.pyplot as plt
import tensorflow as tf
import pandas as pd


# íŒŒì¼ëª…ì— ë§ê²Œ ìˆ˜ì •
df = pd.read_csv("test0.csv", encoding='utf-8')  # ë˜ëŠ” 'cp949'ì¼ ìˆ˜ë„ ìˆìŒ
df.head()



# ìˆ«ìë§Œ ë‚¨ê¸°ê³  ì²˜ë¦¬, ì›í•˜ëŠ” í–‰ ëª…ì¹­ ë„£ê¸°
cols_to_convert = ['ë“±ë¡ì¸êµ¬ (ëª…).1', 'ë“±ë¡ì¸êµ¬ (ëª…).2']
for col in cols_to_convert:
    df[col] = pd.to_numeric(df[col].str.replace(',', ''), errors='coerce')



#í°íŠ¸ ì„¤ì • êµ¬ì—­
# 1. í•œê¸€ í°íŠ¸ ì„¤ì¹˜ (ì´ë¯¸ í–ˆë‹¤ë©´ ìƒëµ ê°€ëŠ¥)
!apt-get -y install fonts-nanum
!fc-cache -fv

# ì •í™•í•˜ê²Œ í°íŠ¸ë¥¼ ì‹œìŠ¤í…œì— ë“±ë¡í•œ ë’¤ ì „ì—­ ì„¤ì •í•˜ëŠ” ë°©ë²•
import matplotlib.pyplot as plt
import matplotlib.font_manager as fm

# 1. í°íŠ¸ ê²½ë¡œ ì§ì ‘ ë“±ë¡
font_path = '/usr/share/fonts/truetype/nanum/NanumGothic.ttf'
fm.fontManager.addfont(font_path)  # ğŸ”‘ í°íŠ¸ ë“±ë¡

# 2. ë“±ë¡í•œ í°íŠ¸ë¥¼ ê°€ì ¸ì˜¤ê¸°
nanum_font = fm.FontProperties(fname=font_path).get_name()
print(f"matplotlibì´ ì¸ì‹í•œ í°íŠ¸ ì´ë¦„: {nanum_font}")

# 3. ì „ì—­ ì„¤ì •ì— ì •í™•í•˜ê²Œ ë°˜ì˜
plt.rcParams['font.family'] = nanum_font
plt.rcParams['axes.unicode_minus'] = False



#ì‹œê°í™” ì‹œì‘

plt.figure(figsize=(10, 5))
plt.plot(df['ì‹œì '], df['ë“±ë¡ì¸êµ¬ (ëª…).1'], marker='o')
plt.title('ë„ì‹œ ì£¼íƒ')
plt.xlabel('ì—°ë„')
plt.ylabel('ë“±ë¡ì¸êµ¬ (ëª…)')
plt.grid(True)
plt.show()


#ì‹œê°í™” ì‹œì‘
plt.figure(figsize=(10, 5))
plt.bar(df['ì‹œì '], df['ë“±ë¡ì¸êµ¬ (ëª…).1'])
plt.title('ì—°ë„ë³„ ë“±ë¡ì¸êµ¬ ì¶”ì´')
plt.xlabel('ì—°ë„')
plt.ylabel('ë“±ë¡ì¸êµ¬ (ëª…)')
plt.grid(axis='y')
plt.show()


#ì‹œê°í™” ì‹œì‘

plt.figure(figsize=(10, 5))
plt.scatter(df['ì‹œì '], df['ë“±ë¡ì¸êµ¬ (ëª…).1'], marker='o')
plt.title('ë„ì‹œ ì£¼íƒ')
plt.xlabel('ì—°ë„')
plt.ylabel('ë“±ë¡ì¸êµ¬ (ëª…)')
plt.grid(True)
plt.show()



# ì‹œê°í™”
plt.figure(figsize=(10, 5))
plt.plot(df['ì‹œì '], df['ë“±ë¡ì¸êµ¬ (ëª…).1'], marker='o', color='blue', label='ë‚¨ì')
plt.plot(df['ì‹œì '], df['ë“±ë¡ì¸êµ¬ (ëª…).2'], marker='s', color='orange', label='ì—¬ì')

plt.title('ë„ì‹œ ì£¼íƒ ë“±ë¡ì¸êµ¬ ì¶”ì´')
plt.xlabel('ì—°ë„')
plt.ylabel('ë“±ë¡ì¸êµ¬ (ëª…)')
plt.grid(True)
plt.legend(loc='upper left')  # ë²”ë¡€ í‘œì‹œ
plt.tight_layout()
plt.show()



# ë°ì´í„° ê¸°ë°˜ ì˜ˆì¸¡


# x_dataì™€ y_data ë¦¬ìŠ¤íŠ¸ì— í•„ìš”í•œ ë°ì´í„° ì¶”ê°€
x_data = []
y_data = []


import math
for row in df.itertuples():
    try:
        x = float(row[1])
        y = float(row[2])
        if math.isnan(x) or math.isnan(y):
            continue  # nanì´ë©´ ê±´ë„ˆëœ€
        x_data.append(x)
        y_data.append(y)
    except (ValueError, TypeError):
        continue  # ë³€í™˜ ì•ˆ ë˜ë©´ ê±´ë„ˆëœ€



print(x_data[:5])  # ì²˜ìŒ ëª‡ ê°œ í™•ì¸
print(y_data[:5])


#ë°ì´í„° í¬ê¸° ì •ë ¬
from sklearn.preprocessing import MinMaxScaler
import numpy as np

# 1. ë¦¬ìŠ¤íŠ¸ë¥¼ numpy ë°°ì—´ë¡œ ë³€í™˜
x_array = np.array(x_data).reshape(-1, 1)
y_array = np.array(y_data).reshape(-1, 1)

# 2. ìŠ¤ì¼€ì¼ëŸ¬ ìƒì„± ë° í•™ìŠµ
x_scaler = MinMaxScaler()
y_scaler = MinMaxScaler()

x_scaled = x_scaler.fit_transform(x_array)
y_scaled = y_scaler.fit_transform(y_array)



import tensorflow as tf
from tensorflow.keras import Sequential
from tensorflow.keras.layers import Dense

# 3. ëª¨ë¸ êµ¬ì„±
model = Sequential([
    Dense(64, activation='relu', input_shape=(1,)),
    Dense(64, activation='relu'),
    Dense(32, activation='relu'),
    Dense(16, activation='relu'),
    Dense(1)
])
model.compile(optimizer='adam', loss='mse')



model.fit(x_scaled, y_scaled, epochs=100, verbose=1)




# 3. ì˜ˆì¸¡
y_pred_scaled = model.predict(x_scaled)
y_pred = y_scaler.inverse_transform(y_pred_scaled)
# 4. ì‹œê°í™”
plt.figure(figsize=(10, 6))

# ì‹¤ì œ ë°ì´í„° (ì )
plt.scatter(x_data, y_data, label='ì‹¤ì œ ì„¸ëŒ€ìˆ˜', color='black')

# ì˜ˆì¸¡ê°’ (ì„ )
plt.plot(x_data, y_pred, label='ì˜ˆì¸¡ ì„¸ëŒ€ìˆ˜', color='red', linewidth=2)
plt.title('ë”¥ëŸ¬ë‹ ê¸°ë°˜ ì„¸ëŒ€ìˆ˜ ì˜ˆì¸¡')
plt.xlabel('ì—°ë„')
plt.ylabel('ì„¸ëŒ€ìˆ˜')
plt.grid(True)
plt.legend()
plt.show()





# 1. ì˜ˆì¸¡ ëŒ€ìƒ ì…ë ¥ê°’ ì¤€ë¹„
x_2030 = np.array([[2030]])
# 2. ìŠ¤ì¼€ì¼ë§
x_2030_scaled = x_scaler.transform(x_2030)
# 3. ì˜ˆì¸¡
y_2030_scaled = model.predict(x_2030_scaled)
# 4. ìŠ¤ì¼€ì¼ ë³µì› (inverse transform)
y_2030 = y_scaler.inverse_transform(y_2030_scaled)
# 5. ê²°ê³¼ ì¶œë ¥
print(f"ğŸŒŸ 2030ë…„ ì˜ˆì¸¡ ì„¸ëŒ€ìˆ˜: {y_2030[0][0]:,.0f} ì„¸ëŒ€")
